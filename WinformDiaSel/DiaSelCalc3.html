<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ê¸‰ìˆ˜ ê´€ê²½ ê²°ì • ê³„ì‚°ê¸° v3</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f1f5f9;
            /* Slate 100 */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="text-slate-800 antialiased selection:bg-cyan-200 selection:text-cyan-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Data & Logic ---

        const FIXTURES = [
            { name: "ëŒ€ë³€ê¸°(í›„ë ˆì‹œë°¸ë¸Œ)", icon: "ğŸš½", unitFactor: 4.9, minPipeSize: 25, isFlushValve: true, desc: "ì„¸ì •ë°¸ë¸Œì‹" },
            { name: "ëŒ€ë³€ê¸°(ë¡œìš°íƒ±í¬)", icon: "ğŸš½", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "íƒ±í¬ì‹" },
            { name: "ë¹„ë°", icon: "âœ¨", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ë¹„ë°ì„¤ë¹„" },
            { name: "ì†Œë³€ê¸°", icon: "ğŸ’§", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ì„¸ì •ë°¸ë¸Œì‹" },
            { name: "ì„¸ë©´ê¸°", icon: "ğŸ§´", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ìˆ˜ë„ê¼­ì§€" },
            { name: "ìƒ¤ì›Œ", icon: "ğŸš¿", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ìƒ¤ì›Œí—¤ë“œ" },
            { name: "ìš•ì¡°", icon: "ğŸ›", unitFactor: 2.6, minPipeSize: 20, isFlushValve: false, desc: "í˜¼í•©ìˆ˜ì „" },
            { name: "ì²­ì†Œì”½í¬", icon: "ğŸ§¹", unitFactor: 2.6, minPipeSize: 20, isFlushValve: false, desc: "ìˆ˜ë„ê¼­ì§€" },
            { name: "ì£¼ë°©ì”½í¬", icon: "ğŸ½ï¸", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "í˜¼í•©ìˆ˜ì „" },
            { name: "ì„¸íƒì”½í¬", icon: "ğŸ§º", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ì„¸íƒìš©" },
            { name: "ìˆ˜ì „(15A)", icon: "ğŸš°", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ì¼ë°˜ìˆ˜ì „" },
            { name: "ìˆ˜ì „(20A)", icon: "ğŸš°", unitFactor: 2.6, minPipeSize: 20, isFlushValve: false, desc: "ì¼ë°˜ìˆ˜ì „" },
            { name: "ìˆ˜ì „(25A)", icon: "ğŸš°", unitFactor: 4.9, minPipeSize: 25, isFlushValve: false, desc: "ì¼ë°˜ìˆ˜ì „" },
            { name: "ì ‘ì‹œì„¸ì²™ê¸°", icon: "ğŸ§¼", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ì„¸ì²™ê¸°" },
            { name: "ì„¸ì¡±ê¸°", icon: "ğŸ¦¶", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false, desc: "ì„¸ì¡±ìš©" }
        ];

        const PIPE_CAPACITY_TABLE = {
            1.0: 15, 2.6: 20, 4.9: 25, 9.2: 32, 14.5: 40,
            30.0: 50, 53.0: 65, 84.6: 80, 178.0: 100, 280.0: 125, 452.0: 150
        };

        function getFlushValveSimultaneity(qty) {
            if (qty <= 0) return 0;
            if (qty <= 2) return 1.0;
            if (qty === 3) return 0.825;
            if (qty === 4) return 0.65;
            if (qty === 5) return 0.60;
            if (qty <= 7) return 0.50;
            if (qty <= 10) return 0.43;
            return 0.40;
        }

        function getGeneralSimultaneity(loadSum) {
            if (loadSum <= 0) return 0;
            if (loadSum < 2) return 1.0;
            if (loadSum < 3) return 1.0;
            if (loadSum < 4) return 0.90;
            if (loadSum < 5) return 0.80;
            if (loadSum < 10) return 0.70;
            if (loadSum < 20) return 0.60;
            if (loadSum < 32) return 0.48;
            if (loadSum < 40) return 0.45;
            if (loadSum < 50) return 0.40;
            return 0.35;
        }

        function determineSize(effectiveLoad) {
            if (effectiveLoad <= 0) return 0;
            const limits = Object.keys(PIPE_CAPACITY_TABLE)
                .map(k => parseFloat(k))
                .sort((a, b) => a - b);

            for (let limit of limits) {
                if (effectiveLoad <= limit) {
                    return PIPE_CAPACITY_TABLE[limit];
                }
            }
            return PIPE_CAPACITY_TABLE[limits[limits.length - 1]];
        }

        function calculate(quantities) {
            const result = {
                genLoadSum: 0, genRate: 0, genEffective: 0,
                fvLoadSum: 0, fvRate: 0, fvEffective: 0,
                fvQtySum: 0, totalEffective: 0, mainSize: 0
            };

            let fvInputs = [], genInputs = [];

            quantities.forEach((qty, index) => {
                const fixture = FIXTURES[index];
                const load = qty * fixture.unitFactor;

                if (fixture.isFlushValve) {
                    fvInputs.push({ quantity: qty, load: load });
                } else {
                    genInputs.push({ quantity: qty, load: load });
                }
            });

            // Flush Valve Calculation (Group A)
            result.fvQtySum = fvInputs.reduce((sum, item) => sum + item.quantity, 0);
            result.fvLoadSum = fvInputs.reduce((sum, item) => sum + item.load, 0);
            result.fvRate = getFlushValveSimultaneity(result.fvQtySum);
            result.fvEffective = result.fvLoadSum * result.fvRate;

            // General Fixture Calculation (Group B)
            // Logic: Total Load -> Rate -> Effective
            result.genLoadSum = genInputs.reduce((sum, item) => sum + item.load, 0);
            result.genRate = getGeneralSimultaneity(result.genLoadSum);
            result.genEffective = result.genLoadSum * result.genRate;

            // Total
            result.totalEffective = result.genEffective + result.fvEffective;
            result.mainSize = determineSize(result.totalEffective);

            return result;
        }

        // --- Components ---

        function Header() {
            return (
                <header className="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200 shadow-sm">
                    <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                            <div className="bg-cyan-600 rounded-lg p-2 text-white shadow-lg shadow-cyan-500/30">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                                </svg>
                            </div>
                            <div>
                                <h1 className="font-bold text-xl text-slate-800 leading-tight">ê¸‰ìˆ˜ ê´€ê²½ ê²°ì •</h1>
                                <p className="text-xs text-slate-500 font-medium tracking-wide">Water Supply Pipe Sizing v3</p>
                            </div>
                        </div>
                        <div className="hidden sm:block">
                            <span className="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-semibold border border-slate-200">
                                ë¶€í•˜ë‹¨ìœ„(FU) ê¸°ì¤€
                            </span>
                        </div>
                    </div>
                </header>
            );
        }

        function InputCard({ fixture, value, onChange }) {
            return (
                <div className="bg-white rounded-xl p-4 shadow-sm border border-slate-200 hover:shadow-md hover:border-cyan-300 transition-all duration-200 group">
                    <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center space-x-3">
                            <div className="text-2xl group-hover:scale-110 transition-transform duration-200">
                                {fixture.icon}
                            </div>
                            <div>
                                <h3 className="font-bold text-slate-700 text-sm">{fixture.name}</h3>
                                <p className="text-[10px] text-slate-400 font-medium">{fixture.desc}</p>
                            </div>
                        </div>
                        <span className="px-2 py-1 bg-slate-50 text-slate-500 text-[10px] font-bold rounded border border-slate-100 whitespace-nowrap">
                            {fixture.unitFactor} FU
                        </span>
                    </div>
                    <div className="relative">
                        <input
                            type="number"
                            min="0"
                            value={value === 0 ? '' : value}
                            onChange={(e) => onChange(e.target.value)}
                            placeholder="0"
                            className="w-full bg-slate-50 border border-slate-200 text-slate-800 text-center font-bold text-lg rounded-lg py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:bg-white transition-all placeholder:text-slate-300"
                        />
                        <div className="absolute inset-y-0 right-3 flex items-center pointer-events-none">
                            <span className="text-xs text-slate-400 font-medium">ê°œ</span>
                        </div>
                    </div>
                </div>
            );
        }

        function ResultSection({ result }) {
            if (!result) return null;

            return (
                <div id="result-section" className="mt-8 space-y-6 fade-in-up pb-12">
                    <div className="relative overflow-hidden bg-gradient-to-br from-cyan-600 to-blue-700 rounded-2xl shadow-xl shadow-cyan-900/20 text-white p-8 mb-8">
                        {/* Background Decoration */}
                        <div className="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl"></div>
                        <div className="absolute bottom-0 left-0 -ml-16 -mb-16 w-64 h-64 bg-cyan-300 opacity-10 rounded-full blur-3xl"></div>

                        <div className="relative z-10 text-center">
                            <h3 className="text-cyan-100 font-medium text-sm tracking-wider uppercase mb-2">Recommended Pipe Size</h3>
                            <div className="flex items-center justify-center space-x-2">
                                <span className="text-7xl font-black tracking-tighter drop-shadow-lg">
                                    {result.mainSize > 0 ? result.mainSize : '--'}
                                </span>
                                <span className="text-2xl font-bold text-cyan-200 mt-6">mm</span>
                            </div>
                            <p className="mt-4 text-sm text-cyan-100 bg-black/20 inline-block px-4 py-1.5 rounded-full backdrop-blur-sm">
                                ìµœì¢… ìœ íš¨ ë¶€í•˜: <strong>{result.totalEffective.toFixed(2)} FU</strong>
                            </p>
                        </div>
                    </div>

                    <div className="grid md:grid-cols-2 gap-4">
                        {/* Flush Valve Calculations */}
                        <div className="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                            <div className="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center justify-between">
                                <h4 className="font-bold text-slate-700 flex items-center">
                                    <span className="w-2 h-2 bg-orange-400 rounded-full mr-2"></span>
                                    ëŒ€ë³€ê¸°(ì„¸ì •ë°¸ë¸Œ) ë¶€í•˜
                                </h4>
                                <span className="text-xs font-mono font-bold text-orange-600 bg-orange-50 px-2 py-0.5 rounded">
                                    {result.fvQtySum} Units
                                </span>
                            </div>
                            <div className="p-5 space-y-3">
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-500">ë¶€í•˜ í•©ê³„ (Total Load)</span>
                                    <span className="font-semibold text-slate-800">{result.fvLoadSum.toFixed(1)} FU</span>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-500">ë™ì‹œ ì‚¬ìš©ë¥  (Factor)</span>
                                    <span className="font-semibold text-slate-800">{result.fvRate.toFixed(3)}</span>
                                </div>
                                <div className="mt-2 pt-3 border-t border-slate-100 flex justify-between items-center bg-orange-50/50 p-2 rounded-lg -mx-2">
                                    <span className="text-orange-800 font-bold text-sm">ìœ íš¨ ë¶€í•˜</span>
                                    <span className="font-black text-orange-600 text-lg">{result.fvEffective.toFixed(2)} FU</span>
                                </div>
                            </div>
                        </div>

                        {/* General Fixture Calculations */}
                        <div className="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                            <div className="bg-slate-50 px-5 py-3 border-b border-slate-100 flex items-center justify-between">
                                <h4 className="font-bold text-slate-700 flex items-center">
                                    <span className="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                    ì¼ë°˜ê¸°êµ¬ ë¶€í•˜
                                </h4>
                            </div>
                            <div className="p-5 space-y-3">
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-500">ë¶€í•˜ í•©ê³„ (Total Load)</span>
                                    <span className="font-semibold text-slate-800">{result.genLoadSum.toFixed(1)} FU</span>
                                </div>
                                <div className="flex justify-between items-center text-sm">
                                    <span className="text-slate-500">ë™ì‹œ ì‚¬ìš©ë¥  (Factor)</span>
                                    <span className="font-semibold text-slate-800">{result.genRate.toFixed(2)}</span>
                                </div>
                                <div className="mt-2 pt-3 border-t border-slate-100 flex justify-between items-center bg-green-50/50 p-2 rounded-lg -mx-2">
                                    <span className="text-green-800 font-bold text-sm">ìœ íš¨ ë¶€í•˜</span>
                                    <span className="font-black text-green-600 text-lg">{result.genEffective.toFixed(2)} FU</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [inputs, setInputs] = useState(Array(FIXTURES.length).fill(0));
            const [result, setResult] = useState(null);

            const handleInputChange = (index, value) => {
                const newInputs = [...inputs];
                newInputs[index] = parseInt(value) || 0;
                setInputs(newInputs);
            };

            const handleCalculate = () => {
                const calcResult = calculate(inputs);
                setResult(calcResult);

                // Slight delay for smooth scroll
                setTimeout(() => {
                    const element = document.getElementById('result-section');
                    if (element) {
                        const headerOffset = 100;
                        const elementPosition = element.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                        window.scrollTo({
                            top: offsetPosition,
                            behavior: "smooth"
                        });
                    }
                }, 100);
            };

            const handleReset = () => {
                setInputs(Array(FIXTURES.length).fill(0));
                setResult(null);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const isFormEmpty = inputs.every(val => val === 0);

            return (
                <div className="min-h-screen">
                    <Header />

                    <main className="max-w-4xl mx-auto px-4 mt-8">

                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6">
                            <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center">
                                <span className="flex items-center justify-center w-6 h-6 bg-slate-100 rounded text-xs mr-2 border border-slate-200">1</span>
                                ìœ„ìƒê¸°êµ¬ ìˆ˜ëŸ‰ ì…ë ¥
                            </h2>
                            <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                                {FIXTURES.map((fixture, index) => (
                                    <InputCard
                                        key={index}
                                        fixture={fixture}
                                        value={inputs[index]}
                                        onChange={(val) => handleInputChange(index, val)}
                                    />
                                ))}
                            </div>
                        </div>

                        <div className="flex space-x-3">
                            <button
                                onClick={handleReset}
                                disabled={isFormEmpty}
                                className={`flex-1 py-4 rounded-xl font-bold text-slate-500 bg-slate-100 border border-slate-200 transition-all ${isFormEmpty ? 'opacity-50 cursor-not-allowed' : 'hover:bg-slate-200 hover:text-slate-600'}`}
                            >
                                ì´ˆê¸°í™”
                            </button>
                            <button
                                onClick={handleCalculate}
                                disabled={isFormEmpty}
                                className={`flex-[2] py-4 rounded-xl font-bold text-white shadow-lg shadow-cyan-500/25 transition-all transform ${isFormEmpty ? 'bg-slate-300 cursor-not-allowed shadow-none' : 'bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 active:scale-[0.98]'}`}
                            >
                                {result ? 'ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°' : 'ê´€ê²½ ê³„ì‚°í•˜ê¸°'}
                            </button>
                        </div>

                        <ResultSection result={result} />

                    </main>

                    <footer className="max-w-4xl mx-auto px-4 mt-8 pb-12 text-center">
                        <p className="text-slate-400 text-xs">
                            ë³¸ ê³„ì‚°ê¸°ëŠ” ì¼ë°˜ì ì¸ ê¸‰ìˆ˜ ë¶€í•˜ë‹¨ìœ„ë²•ì„ ë”°ë¥´ë©°, ì‹¤ì œ ì„¤ê³„ ì‹œì—ëŠ” í˜„ì¥ ìƒí™©ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
                        </p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
