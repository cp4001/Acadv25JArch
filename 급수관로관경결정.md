# 배수관로결정로직.md (실제 내용: 급수 관경 결정 알고리즘)

## 1. 개요
이 문서는 건물의 급수 부하단위(Fixture Unit, FU)법을 기반으로 급수 배관의 구경(Pipe Size)을 산정하는 알고리즘을 기술한다. 
특정 엑셀 시트(급수관경결정.xlsm)의 로직을 역설계하였으며, **대변기(세정밸브형)**와 **일반 위생기구**를 분리하여 동시사용률을 적용하는 것이 핵심이다.

## 2. 입력 데이터 모델 (Input Data Model)
각 위생기구는 다음과 같은 속성을 가져야 한다.

| 속성명 | 데이터 타입 | 설명 | 비고 |
| :--- | :--- | :--- | :--- |
| **Name** | String | 기구 명칭 | 예: 대변기, 세면기 |
| **Quantity** | Integer | 설치 수량 | 사용자 입력값 |
| **UnitFactor** | Double | 기구 급수부하단위 (FU) | 15A 환산값 |
| **MinPipeSize** | Integer | 기구 최소 접속 관경 (mm) | 예: 15, 20, 25 |
| **IsFlushValve** | Boolean | 세정밸브(Flush Valve) 사용 여부 | **중요:** 대변기 구분용 |

## 3. 참조 테이블 (Reference Tables)
이 알고리즘은 다음 3가지의 고정된 상수 테이블을 참조한다.

### 3.1. 관경 선정 기준표 (Pipe Capacity Table)
유효 부하단위(Effective Load)가 `MaxLoad` 이하일 때 해당 `PipeSize`를 선정한다.

| MaxLoad (FU) | PipeSize (A) | 비고 |
| :--- | :--- | :--- |
| **1.0** | 15 | |
| **2.6** | 20 | |
| **4.9** | 25 | |
| **9.2** | 32 | |
| **14.5** | 40 | **주의:** 14.5 초과 시 50A로 진입 |
| **30.0** | 50 | |
| **53.0** | 65 | |
| **84.6** | 80 | |
| **178.0** | 100 | |
| **280.0** | 125 | |
| **452.0** | 150 | |

### 3.2. 대변기(세정밸브) 동시사용률표 (Flush Valve Simultaneity)
**기준:** 대변기 설치 **수량(Quantity)** 합계

| 기구 수량 (개) | 적용 비율 (%) | 적용 비율 (Decimal) |
| :--- | :--- | :--- |
| 1 ~ 2 | 100% | 1.0 |
| 3 | 82.5% | 0.825 |
| 4 | 65% | 0.65 |
| 5 | 60% | 0.60 |
| 6 ~ 7 | 50% | 0.50 |
| 8 ~ 9 | 45% | 0.45 |
| 10 이상 | 40% (근사치) | 0.40 |

### 3.3. 일반기구 동시사용률표 (General Fixture Simultaneity)
**기준:** 일반기구 **부하단위(FU)** 합계

| 부하단위 합계 (FU) | 적용 비율 (%) | 적용 비율 (Decimal) |
| :--- | :--- | :--- |
| 0 ~ 3 미만 | 100% | 1.0 |
| 3 ~ 4 미만 | 90% | 0.90 |
| 4 ~ 5 미만 | 80% | 0.80 |
| 5 ~ 10 미만 | 70% | 0.70 |
| 10 ~ 20 미만 | 60% | 0.60 |
| 20 ~ 32 미만 | 48% | 0.48 |
| **32 ~ 40 미만** | **45%** | **0.45** |
| 40 ~ 50 미만 | 40% | 0.40 |
| 50 이상 | 35% | 0.35 |

---

## 4. 계산 로직 (Calculation Logic)

### Step 1: 기구 그룹 분리
입력된 기구 리스트를 `IsFlushValve` 속성에 따라 두 그룹으로 나눈다.
* **Group A:** 대변기 (IsFlushValve = True)
* **Group B:** 일반기구 (IsFlushValve = False)

### Step 2: 그룹별 기초 데이터 집계
* **Group A (대변기):**
    * `FV_Qty` = $\sum$(대변기 수량)
    * `FV_Load` = $\sum$(대변기 수량 $\times$ UnitFactor)
* **Group B (일반기구):**
    * `Gen_Load` = $\sum$(일반기구 수량 $\times$ UnitFactor)

### Step 3: 동시사용률 적용 (이원화 로직)
서로 다른 기준표를 적용하여 유효 부하를 산출한다.
1.  **대변기 유효부하 (`FV_Effective`):**
    * 참조표: **3.2 대변기 동시사용률표**
    * Lookup Key: `FV_Qty` (수량)
    * 계산: `FV_Load` $\times$ `Rate(FV_Qty)`
2.  **일반기구 유효부하 (`Gen_Effective`):**
    * 참조표: **3.3 일반기구 동시사용률표**
    * Lookup Key: `Gen_Load` (부하단위 합계)
    * 계산: `Gen_Load` $\times$ `Rate(Gen_Load)`

### Step 4: 최종 유효부하 합산
* `Total_Effective_Load` = `FV_Effective` + `Gen_Effective`
* *(참고: 소수점 처리는 일반적으로 2째 자리 반올림)*

### Step 5: 관경 결정 (Lookup)
1.  **3.1 관경 선정 기준표**를 오름차순으로 순회한다.
2.  조건: `Total_Effective_Load` $\le$ `Table.MaxLoad` 인 최초의 값을 찾는다.
3.  해당하는 `Table.PipeSize`를 기본 관경으로 선정한다.
4.  (옵션) 메인 배관이 아닌 개별 지관의 경우, 연결된 기구 중 가장 큰 `MinPipeSize`와 비교하여 더 큰 값을 취한다. (메인 배관은 보통 이 단계 생략 가능)

---

## 5. 검증 데이터 (Test Case)

다음 데이터를 입력했을 때 결과가 정확히 **50A**가 나와야 로직이 정상 구현된 것이다.

**입력:**
1. 대변기 (FV형, 4.9 FU): 3개
2. 일반기구 (소변기, 세면기 등): 다수 (총 부하합계 36.2 FU)

**계산 과정:**
1. **대변기:**
    * 수량 3개 $\rightarrow$ 동시사용률 표(수량 기준) **82.5%** 적용
    * 부하: $3 \times 4.9 = 14.7$
    * 유효부하: $14.7 \times 0.825 = \mathbf{12.13}$
2. **일반기구:**
    * 부하합계 36.2 $\rightarrow$ 동시사용률 표(부하 기준, 32~40구간) **45%** 적용
    * 유효부하: $36.2 \times 0.45 = \mathbf{16.29}$
3. **최종 합산:**
    * $12.13 + 16.29 = \mathbf{28.42}$
4. **관경 선정:**
    * `28.42`는 **40A 한계값(14.5)**를 초과함.
    * **50A 한계값(30.0)** 이내임.
    * **결과: 50A**

---

## 6. 부록: 기구별 표준 데이터 (Standard Fixture Data)
프로그램 초기 세팅 시, 아래의 표준 값을 기본 데이터베이스(DB)나 설정값으로 포함해야 한다.

| 기구 명칭 (Name) | 15A 환산값 (UnitFactor) | 최소 관경 (MinPipeSize) | 세정밸브 여부 (IsFlushValve) |
| :--- | :---: | :---: | :---: |
| **대변기 (세정밸브형)** | **4.9** | **25A** | **True** (Group A) |
| 대변기 (탱크형) | 2.0 | 15A | False (Group B) |
| 소변기 (세정밸브형) | 1.0 | 15A | False* (일반적으로 B) |
| 세면기 | 1.0 | 15A | False (Group B) |
| 청소씽크 | 2.6 | 20A | False (Group B) |
| 샤워기 | 1.0 | 15A | False (Group B) |
| 욕조 | 2.6 | 20A | False (Group B) |
| 주방씽크 | 1.0 | 15A | False (Group B) |
| 세탁기 | 2.0 | 15A | False (Group B) |

*주: 소변기는 세정밸브를 쓰더라도 급수 설계 기준상 일반기구 부하 곡선을 따르는 경우가 많으므로 Group B로 분류함 (설계 기준에 따라 조정 가능).*

*작성일: 2025.12.24*
*기반: 급수관경결정.xlsm 역설계 분석*
