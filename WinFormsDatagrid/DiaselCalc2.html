<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ê¸‰ìˆ˜ ê´€ê²½ ê²°ì • ê³„ì‚°ê¸°</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* ë‹¤í¬ í…Œë§ˆ & ë¯¸ë˜ì  ë””ìì¸ */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            background-attachment: fixed;
        }
        .card {
            @apply bg-gray-900/90 backdrop-blur-sm rounded-xl shadow-2xl border border-purple-500/40;
        }
        .input-field {
            @apply w-full px-2 py-1 text-sm bg-gray-800/60 text-white border border-purple-500/50 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all;
            font-weight: 600;
            height: 30px;
            line-height: 1.2;
        }
        .input-field::placeholder {
            color: rgba(168, 85, 247, 0.4);
        }
        /* Chrome, Safari, Edge, Opera - ìˆ«ì ì…ë ¥ í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
        .input-field::-webkit-inner-spin-button,
        .input-field::-webkit-outer-spin-button {
            opacity: 1;
            height: 100%;
        }
        /* Firefox - ìˆ«ì ì…ë ¥ í•„ë“œ */
        .input-field[type=number] {
            -moz-appearance: textfield;
        }
        .btn-primary {
            @apply w-full py-3 text-base font-bold text-white bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg hover:from-purple-700 hover:to-blue-700 active:from-purple-800 active:to-blue-800 transition-all shadow-lg shadow-purple-500/50;
        }
        .label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #bbf7d0;
            margin-bottom: 0.25rem;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }
        .result-card {
            @apply bg-gradient-to-br from-purple-900/50 to-blue-900/50 border-2 border-purple-400/60 shadow-purple-500/30;
        }
        .badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-purple-500/40 text-purple-100 border border-purple-400/60;
        }
        
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out;
        }
        
        /* ë°˜ì§ì´ëŠ” ë³„ íš¨ê³¼ */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #9333ea, #3b82f6);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #a855f7, #60a5fa);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // ê¸°êµ¬ ë°ì´í„°
        const FIXTURES = [
            { name: "ëŒ€ë³€ê¸°", unitFactor: 4.9, minPipeSize: 25, isFlushValve: true },
            { name: "ì†Œë³€ê¸°", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false },
            { name: "ì„¸ë©´ê¸°", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false },
            { name: "ì²­ì†Œì”½í¬", unitFactor: 2.6, minPipeSize: 20, isFlushValve: false },
            { name: "ìƒ¤ì›Œ", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false },
            { name: "ìš•ì¡°", unitFactor: 2.6, minPipeSize: 20, isFlushValve: false },
            { name: "ì£¼ë°©ì”½í¬", unitFactor: 1.0, minPipeSize: 15, isFlushValve: false }
        ];

        // ê´€ê²½ ì„ ì • ê¸°ì¤€í‘œ
        const PIPE_CAPACITY_TABLE = {
            1.0: 15, 2.6: 20, 4.9: 25, 9.2: 32, 14.5: 40,
            30.0: 50, 53.0: 65, 84.6: 80, 178.0: 100, 280.0: 125, 452.0: 150
        };

        // ëŒ€ë³€ê¸° ë™ì‹œì‚¬ìš©ë¥ 
        function getFlushValveSimultaneity(qty) {
            if (qty <= 0) return 0;
            if (qty <= 2) return 1.0;
            if (qty === 3) return 0.825;
            if (qty === 4) return 0.65;
            if (qty === 5) return 0.60;
            if (qty <= 7) return 0.50;
            if (qty <= 10) return 0.43;
            return 0.40;
        }

        // ì¼ë°˜ê¸°êµ¬ ë™ì‹œì‚¬ìš©ë¥ 
        function getGeneralSimultaneity(loadSum) {
            if (loadSum <= 0) return 0;
            if (loadSum < 2) return 1.0;
            if (loadSum < 3) return 1.0;
            if (loadSum < 4) return 0.90;
            if (loadSum < 5) return 0.80;
            if (loadSum < 10) return 0.70;
            if (loadSum < 20) return 0.60;
            if (loadSum < 32) return 0.48;
            if (loadSum < 40) return 0.45;
            if (loadSum < 50) return 0.40;
            return 0.35;
        }

        // ê´€ê²½ ê²°ì •
        function determineSize(effectiveLoad) {
            if (effectiveLoad <= 0) return 0;
            const limits = Object.keys(PIPE_CAPACITY_TABLE)
                .map(k => parseFloat(k))
                .sort((a, b) => a - b);
            
            for (let limit of limits) {
                if (effectiveLoad <= limit) {
                    return PIPE_CAPACITY_TABLE[limit];
                }
            }
            return PIPE_CAPACITY_TABLE[limits[limits.length - 1]];
        }

        // ë©”ì¸ ê³„ì‚° í•¨ìˆ˜
        function calculate(quantities) {
            const result = {
                genLoadSum: 0, genRate: 0, genEffective: 0,
                fvLoadSum: 0, fvRate: 0, fvEffective: 0,
                fvQtySum: 0, totalEffective: 0, mainSize: 0
            };

            let fvInputs = [], genInputs = [];
            
            quantities.forEach((qty, index) => {
                const fixture = FIXTURES[index];
                const load = qty * fixture.unitFactor;
                
                if (fixture.isFlushValve) {
                    fvInputs.push({ quantity: qty, load: load });
                } else {
                    genInputs.push({ quantity: qty, load: load });
                }
            });

            result.fvQtySum = fvInputs.reduce((sum, item) => sum + item.quantity, 0);
            result.fvLoadSum = fvInputs.reduce((sum, item) => sum + item.load, 0);
            result.fvRate = getFlushValveSimultaneity(result.fvQtySum);
            result.fvEffective = result.fvLoadSum * result.fvRate;

            result.genLoadSum = genInputs.reduce((sum, item) => sum + item.load, 0);
            result.genRate = getGeneralSimultaneity(result.genLoadSum);
            result.genEffective = result.genLoadSum * result.genRate;

            result.totalEffective = result.genEffective + result.fvEffective;
            result.mainSize = determineSize(result.totalEffective);

            return result;
        }

        // React ì»´í¬ë„ŒíŠ¸
        function WaterPipeCalculator() {
            const [inputs, setInputs] = useState(Array(7).fill(0));
            const [result, setResult] = useState(null);
            const [showResult, setShowResult] = useState(false);

            const handleInputChange = (index, value) => {
                const newInputs = [...inputs];
                newInputs[index] = parseInt(value) || 0;
                setInputs(newInputs);
            };

            const handleCalculate = () => {
                const calcResult = calculate(inputs);
                setResult(calcResult);
                setShowResult(true);
                // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
                setTimeout(() => {
                    document.getElementById('result-section')?.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
            };

            const handleReset = () => {
                setInputs(Array(7).fill(0));
                setShowResult(false);
                setResult(null);
            };

            return (
                <div className="min-h-screen pb-8">
                    {/* í—¤ë” */}
                    <header className="bg-gradient-to-r from-purple-900/95 via-blue-900/95 to-purple-900/95 backdrop-blur-md text-white py-5 px-4 shadow-2xl shadow-purple-500/20 sticky top-0 z-10 border-b border-purple-500/40">
                        <div className="container max-w-2xl mx-auto">
                            <h1 className="text-2xl font-extrabold text-center text-white drop-shadow-lg">ğŸ’§ ê¸‰ìˆ˜ ê´€ê²½ ê²°ì • ê³„ì‚°</h1>
                            <p className="text-center text-purple-200 text-sm mt-1 font-medium">ìœ„ìƒê¸°êµ¬ ë¶€í•˜ë‹¨ìœ„ë²•</p>
                        </div>
                    </header>

                    <div className="container max-w-2xl mx-auto px-4 mt-6">
                        {/* ì…ë ¥ ì¹´ë“œ */}
                        <div className="card p-5 mb-4">
                            <div className="flex items-center justify-between mb-3">
                                <h2 className="text-lg font-bold text-white">ìœ„ìƒê¸°êµ¬ ìˆ˜ëŸ‰ ì…ë ¥</h2>
                                <span className="badge">7ê°œ í•­ëª©</span>
                            </div>
                            
                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-2.5">
                                {FIXTURES.map((fixture, index) => (
                                    <div key={index}>
                                        <label className="label">
                                            {fixture.name}
                                            <span className="text-[10px] text-yellow-300 ml-1 font-semibold">
                                                ({fixture.unitFactor} FU)
                                            </span>
                                        </label>
                                        <input
                                            type="number"
                                            min="0"
                                            value={inputs[index] === 0 ? '' : inputs[index]}
                                            onChange={(e) => handleInputChange(index, e.target.value)}
                                            className="input-field"
                                            placeholder="0"
                                        />
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* ê³„ì‚° ë²„íŠ¼ */}
                        <div className="flex justify-end mb-6">
                            <button 
                                onClick={handleCalculate} 
                                className="px-8 py-3 text-base font-bold text-white bg-gray-800/60 border-2 border-purple-400/50 rounded-lg hover:bg-gray-700/60 hover:border-purple-400 active:bg-gray-600/60 transition-all"
                            >
                                ğŸ”
                            </button>
                        </div>

                        {/* ê²°ê³¼ ì˜ì—­ */}
                        {showResult && result && (
                            <div id="result-section" className="space-y-4 animate-fade-in">
                                {/* ìµœì¢… ê´€ê²½ */}
                                <div className="card result-card p-8">
                                    <div className="text-center">
                                        <p className="text-sm font-bold text-purple-200 mb-2">ìµœì¢… ê²°ì • ê´€ê²½</p>
                                        <div className="text-6xl font-black bg-gradient-to-r from-purple-300 to-blue-300 bg-clip-text text-transparent mb-1 drop-shadow-2xl">
                                            {result.mainSize > 0 ? result.mainSize : '--'}
                                        </div>
                                        <p className="text-2xl font-bold text-white">A (mm)</p>
                                    </div>
                                </div>

                                {/* ìƒì„¸ ê³„ì‚° ê³¼ì • */}
                                <div className="card p-6">
                                    <h3 className="text-lg font-bold text-white mb-4">ğŸ“Š ìƒì„¸ ê³„ì‚° ê³¼ì •</h3>
                                    
                                    {/* ì¼ë°˜ê¸°êµ¬ ê·¸ë£¹ */}
                                    <div className="bg-green-900/40 rounded-lg p-4 mb-4 border border-green-400/40">
                                        <h4 className="font-bold text-green-200 mb-3 flex items-center">
                                            <span className="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                                            ì¼ë°˜ê¸°êµ¬ ê·¸ë£¹
                                        </h4>
                                        <div className="grid grid-cols-2 gap-3 text-sm">
                                            <div>
                                                <span className="text-purple-200 font-medium">ë¶€í•˜í•©ê³„</span>
                                                <p className="font-bold text-white">{result.genLoadSum.toFixed(1)} FU</p>
                                            </div>
                                            <div>
                                                <span className="text-purple-200 font-medium">ë™ì‹œì‚¬ìš©ë¥ </span>
                                                <p className="font-bold text-white">{result.genRate.toFixed(2)}</p>
                                            </div>
                                            <div className="col-span-2">
                                                <span className="text-purple-200 font-medium">ìœ íš¨ë¶€í•˜</span>
                                                <p className="font-extrabold text-green-300 text-lg">{result.genEffective.toFixed(2)} FU</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ëŒ€ë³€ê¸° ê·¸ë£¹ */}
                                    <div className="bg-orange-900/40 rounded-lg p-4 mb-4 border border-orange-400/40">
                                        <h4 className="font-bold text-orange-200 mb-3 flex items-center">
                                            <span className="w-2 h-2 bg-orange-400 rounded-full mr-2"></span>
                                            ëŒ€ë³€ê¸°(ì„¸ì •ë°¸ë¸Œ) ê·¸ë£¹
                                        </h4>
                                        <div className="grid grid-cols-2 gap-3 text-sm">
                                            <div>
                                                <span className="text-purple-200 font-medium">ë¶€í•˜í•©ê³„</span>
                                                <p className="font-bold text-white">{result.fvLoadSum.toFixed(1)} FU</p>
                                            </div>
                                            <div>
                                                <span className="text-purple-200 font-medium">ìˆ˜ëŸ‰</span>
                                                <p className="font-bold text-white">{result.fvQtySum} ê°œ</p>
                                            </div>
                                            <div>
                                                <span className="text-purple-200 font-medium">ë™ì‹œì‚¬ìš©ë¥ </span>
                                                <p className="font-bold text-white">{result.fvRate.toFixed(3)}</p>
                                            </div>
                                            <div>
                                                <span className="text-purple-200 font-medium">ìœ íš¨ë¶€í•˜</span>
                                                <p className="font-extrabold text-orange-300 text-lg">{result.fvEffective.toFixed(2)} FU</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ìµœì¢… í•©ê³„ */}
                                    <div className="bg-blue-900/40 rounded-lg p-4 border-2 border-blue-400/60">
                                        <div className="flex justify-between items-center">
                                            <span className="font-bold text-blue-200">ìµœì¢… ìœ íš¨ë¶€í•˜</span>
                                            <span className="text-2xl font-black text-blue-300">
                                                {result.totalEffective.toFixed(2)} FU
                                            </span>
                                        </div>
                                        <p className="text-xs text-purple-200 mt-2 font-medium">
                                            = ì¼ë°˜ê¸°êµ¬ {result.genEffective.toFixed(2)} + ëŒ€ë³€ê¸° {result.fvEffective.toFixed(2)}
                                        </p>
                                    </div>
                                </div>

                                {/* ì…ë ¥ ìš”ì•½ */}
                                <div className="card p-6">
                                    <h3 className="text-lg font-bold text-white mb-4">ğŸ“ ì…ë ¥ ìš”ì•½</h3>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        {FIXTURES.map((fixture, index) => (
                                            inputs[index] > 0 && (
                                                <div key={index} className="bg-gray-800/60 rounded-lg p-3 border border-purple-400/40">
                                                    <p className="text-xs text-purple-200 font-medium">{fixture.name}</p>
                                                    <p className="text-lg font-bold text-white">{inputs[index]}</p>
                                                </div>
                                            )
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ì•ˆë‚´ ë¬¸êµ¬ */}
                        {!showResult && (
                            <div className="card p-6 text-center text-white">
                                <p className="text-sm font-semibold">ìœ„ìƒê¸°êµ¬ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ê³  ğŸ” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                                <p className="text-xs mt-2 text-purple-200 font-medium">
                                    ğŸ’¡ FU = Fixture Unit (ë¶€í•˜ë‹¨ìœ„)
                                </p>
                            </div>
                        )}
                    </div>

                    {/* í‘¸í„° */}
                    <footer className="mt-12 pb-6 text-center text-xs text-purple-200 font-medium">
                        <p>ê¸‰ìˆ˜ ë¶€í•˜ë‹¨ìœ„ë²• ê¸°ë°˜ ê´€ê²½ ê²°ì • ì‹œìŠ¤í…œ</p>
                        <p className="mt-1">Â© 2025 Water Pipe Sizing Calculator</p>
                    </footer>
                </div>
            );
        }

        // React ë Œë”ë§
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WaterPipeCalculator />);
    </script>
</body>
</html>
